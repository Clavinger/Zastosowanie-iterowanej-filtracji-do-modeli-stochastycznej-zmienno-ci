########################################################Filtrowanie danych
bsv.filt<-pomp(data=data.frame(y=zwroty.sim,
time=1:n),
statenames=bsv_statenames,
paramnames=bsv_paramnames,
covarnames=bsv_covarnames,
times="time",
t0=0,
covar=data.frame(covaryt=c(0,zwroty.sim),
time=0:n),
tcovar="time",
rmeasure=Csnippet(bsv_rmeasure),
dmeasure=Csnippet(bsv_dmeasure),
rprocess=discrete.time.sim(step.fun=Csnippet(bsv_rproc.filt),delta.t=1),
initializer=Csnippet(bsv_initializer),
toEstimationScale=Csnippet(bsv_toEstimationScale),
fromEstimationScale=Csnippet(bsv_fromEstimationScale)
)
#wykres filtracji dla prawdziwych parametr?w
pf1 <- pfilter(bsv.filt,params=params_test,
Np=1000,filter.traj=T)
plot(pf1)
str(pf1)
wykres2<-rbind(pf1@data,
pf1@eff.sample.size,
pf1@cond.loglik,
pf1@filter.traj[1, 1,2:1001],
exp(pf1@filter.traj[1, 1,2:1001]/2),
log.volatility.list$states[1,1,],
exp(log.volatility.list$states[1,1,]/2))
row.names(wykres2)<-c("y","eff.sample.size","cond.loglik",
"filtered H", "filtered exp(H)","H","exp(H/2)")
wykres2<-as.data.frame(t(wykres2))
g1<-ggplot(data = as.data.frame(wykres2), aes(x = 1:n, y = y))  +
geom_line(color = "royalblue", size = .5)+ggtitle('zwroty')+labs(x="time")+theme_bw()
g2<-ggplot(data = as.data.frame(wykres2), aes(x = 1:n, y = H))  +
geom_line(color = "royalblue", size = .5)+ggtitle('log-zmienność')+labs(x="time")+theme_bw()
g3<-ggplot(data = as.data.frame(wykres2), aes(x = 1:n, y = exp(H/2)))  +
geom_line(color = "royalblue", size = .5)+ggtitle('zmienność')+labs(x="time")+theme_bw()+
g4<-ggplot(data = as.data.frame(wykres2), aes(x = 1:n, y = eff.sample.size))  +
geom_line(color = "royalblue", size = .5)+ggtitle('eff.sample.size')+labs(x="time")+theme_bw()
g5<-ggplot(data = as.data.frame(wykres2), aes(x = 1:n, y = cond.loglik))  +
geom_line(color = "royalblue", size = .5)+ggtitle('cond.loglik')+labs(x="time")+theme_bw()
grid.arrange(g1, g4,g2,g5,g3, nrow=3,ncol=2)
##########################################################################
##########################################################################
######################################################Estymacja parametrow
g1<-ggplot(data = as.data.frame(wykres2), aes(x = 1:n, y = y))  +
geom_line(color = "royalblue", size = .5)+ggtitle('zwroty')+labs(x="time")+theme_bw()
g2<-ggplot(data = as.data.frame(wykres2), aes(x = 1:n, y = H))  +
geom_line(color = "royalblue", size = .5)+ggtitle('log-zmienność')+labs(x="time")+theme_bw()
g3<-ggplot(data = as.data.frame(wykres2), aes(x = 1:n, y = exp(H/2)))  +
geom_line(color = "royalblue", size = .5)+ggtitle('zmienność')+labs(x="time")+theme_bw()
g4<-ggplot(data = as.data.frame(wykres2), aes(x = 1:n, y = eff.sample.size))  +
geom_line(color = "royalblue", size = .5)+ggtitle('eff.sample.size')+labs(x="time")+theme_bw()
g5<-ggplot(data = as.data.frame(wykres2), aes(x = 1:n, y = cond.loglik))  +
geom_line(color = "royalblue", size = .5)+ggtitle('cond.loglik')+labs(x="time")+theme_bw()
grid.arrange(g1, g4,g2,g5,g3, nrow=3,ncol=2)
g1<-ggplot(data = as.data.frame(wykres2), aes(x = 1:n, y = y))  +
geom_line(color = "royalblue", size = .5)+ggtitle('zwroty')+labs(x="time")+theme_bw()
g2<-ggplot(data = as.data.frame(wykres2), aes(x = 1:n, y = H))  +
geom_line(color = "royalblue", size = .5)+ggtitle('log-zmienność')+labs(x="time")+theme_bw()
g3<-ggplot(data = as.data.frame(wykres2), aes(x = 1:n, y = exp(H/2)))  +
geom_line(color = "royalblue", size = .5)+ggtitle('zmienność')+labs(x="time")+theme_bw()
g4<-ggplot(data = as.data.frame(wykres2), aes(x = 1:n, y = eff.sample.size))  +
geom_line(color = "royalblue", size = .5)+ggtitle('eff.sample.size')+labs(x="time")+theme_bw()
g5<-ggplot(data = as.data.frame(wykres2), aes(x = 1:n, y = cond.loglik))  +
geom_line(color = "royalblue", size = .5)+ggtitle('cond.loglik')+labs(x="time")+theme_bw()
grid.arrange(g1, g4,g2,g5,g3, nrow=3,ncol=2)
g1<-ggplot(data = as.data.frame(wykres2), aes(x = 1:n, y = y))  +
geom_line(color = "royalblue", size = .5)+ggtitle('zwroty')+labs(x="time")+theme_bw()
g2<-ggplot(data = as.data.frame(wykres2), aes(x = 1:n, y = H))  +
geom_line(color = "royalblue", size = .5)+ggtitle('log-zmienność')+labs(x="time")+theme_bw()
g3<-ggplot(data = as.data.frame(wykres2), aes(x = 1:n, y = exp(H/2)))  +
geom_line(color = "royalblue", size = .5)+ggtitle('zmienność')+labs(x="time")+theme_bw()
g4<-ggplot(data = as.data.frame(wykres2), aes(x = 1:n, y = eff.sample.size))  +
geom_line(color = "royalblue", size = .5)+ggtitle('eff.sample.size')+labs(x="time")+theme_bw()
g5<-ggplot(data = as.data.frame(wykres2), aes(x = 1:n, y = cond.loglik))  +
geom_line(color = "royalblue", size = .5)+ggtitle('cond.loglik')+labs(x="time")+theme_bw()
grid.arrange(g1, g4,g2,g5,g3, nrow=3,ncol=2)
ggplot(data = as.data.frame(wykres2), aes(x = 1:n, y = H,filtered H ))  +
geom_line(color = "royalblue", size = .5)+ggtitle('log-zmienność')+labs(x="time")+theme_bw()
ggplot(data = as.data.frame(wykres2), aes(x = 1:n, H, filtered H ))  +
geom_line(color = "royalblue", size = .5)
ggplot(data = as.data.frame(wykres2), aes(x = 1:n, y=H))  +
geom_line(color = "royalblue", size = .5)
ggplot(data = as.data.frame(wykres2), aes(x = 1:n, y=H))  +
geom_line(color = "royalblue", size = .5)+ggtitle('log-zmienność')+labs(x="time")+theme_bw()+
geom_line(data = as.data.frame(wykres2), aes(x = 1:n, y=filtered H), color = "red", size = .5)
wykres2<-rbind(pf1@data,
pf1@eff.sample.size,
pf1@cond.loglik,
pf1@filter.traj[1, 1,2:1001],
exp(pf1@filter.traj[1, 1,2:1001]/2),
log.volatility.list$states[1,1,],
exp(log.volatility.list$states[1,1,]/2))
row.names(wykres2)<-c("y","eff.sample.size","cond.loglik",
"filtered_H", "filtered_exp(H)","H","exp(H/2)")
wykres2<-as.data.frame(t(wykres2))
ggplot(data = as.data.frame(wykres2), aes(x = 1:n, y=H))  +
geom_line(color = "royalblue", size = .5)+ggtitle('log-zmienność')+labs(x="time")+theme_bw()+
+geom_line(data = as.data.frame(wykres2), aes(x = 1:n, y=filtered_H), color = "red", size = .5)
wykres2a<-as.data.frame(t(wykres2[c(4,6),]))
wykres2a
wykres2.matrix<-rbind(pf1@data,
pf1@eff.sample.size,
pf1@cond.loglik,
pf1@filter.traj[1, 1,2:1001],
exp(pf1@filter.traj[1, 1,2:1001]/2),
log.volatility.list$states[1,1,],
exp(log.volatility.list$states[1,1,]/2))
row.names(wykres2)<-c("y","eff.sample.size","cond.loglik",
"filtered_H", "filtered_exp(H)","H","exp(H/2)")
wykres2<-as.data.frame(t(wykres2.matrix))
wykres2a<-as.data.frame(t(wykres2.matrix[,c(4,6)]))
wykres2.matrix<-rbind(pf1@data,
pf1@eff.sample.size,
pf1@cond.loglik,
pf1@filter.traj[1, 1,2:1001],
exp(pf1@filter.traj[1, 1,2:1001]/2),
log.volatility.list$states[1,1,],
exp(log.volatility.list$states[1,1,]/2))
row.names(wykres2.matrix)<-c("y","eff.sample.size","cond.loglik",
"filtered_H", "filtered_exp(H)","H","exp(H/2)")
wykres2<-as.data.frame(t(wykres2.matrix))
wykres2a<-as.data.frame(t(wykres2.matrix[,c(4,6)]))
wykres2a
wykres2.matrix<-rbind(pf1@data,
pf1@eff.sample.size,
pf1@cond.loglik,
pf1@filter.traj[1, 1,2:1001],
exp(pf1@filter.traj[1, 1,2:1001]/2),
log.volatility.list$states[1,1,],
exp(log.volatility.list$states[1,1,]/2))
row.names(wykres2.matrix)<-c("y","eff.sample.size","cond.loglik",
"filtered_H", "filtered_exp(H)","H","exp(H/2)")
wykres2<-as.data.frame(t(wykres2.matrix))
wykres2a<-as.data.frame(t(wykres2.matrix[c(4,6),]))
wykres2a
library(tidyr)
?gather
wykres2a<-as.data.frame(t(rbind(1:n,wykres2.matrix[c(4,6),])))
wykres2a
wykres2.matrix<-rbind(pf1@data,
pf1@eff.sample.size,
pf1@cond.loglik,
pf1@filter.traj[1, 1,2:1001],
exp(pf1@filter.traj[1, 1,2:1001]/2),
log.volatility.list$states[1,1,],
exp(log.volatility.list$states[1,1,]/2),
1:n)
row.names(wykres2.matrix)<-c("y","eff.sample.size","cond.loglik",
"filtered_H", "filtered_exp(H)","H","exp(H/2)","time")
wykres2<-as.data.frame(t(wykres2.matrix))
wykres2a<-as.data.frame(t(wykres2.matrix[c(4,6,8),]))
wykres2a
wykres2a.long<-gather(data=wykres2a,key="time",value = "rys","H","filtered_H")
ggplot(data = wykres2a.long, aes(x = "time", y="rys"))  +
geom_line(color = "royalblue", size = .5)+ggtitle('log-zmienność')+labs(x="time")+theme_bw()
ggplot(data = wykres2a.long, aes(x = "time", y="rys"))  +
geom_line(color = c("royalblue","red"), size = .5)+ggtitle('log-zmienność')+labs(x="time")+theme_bw()
wykres2a.long
wykres2a.long<-gather(data=wykres2a,key,value,"H","filtered_H")
wykres2a.long
ggplot(data = wykres2a.long, aes(x = "time", y=value))  +
geom_line(color = key, size = .5)+ggtitle('log-zmienność')+labs(x="time")+theme_bw()
ggplot(data = wykres2a.long, aes(x = "time", y=value,color = key ))  +
geom_line(size = .5)+ggtitle('log-zmienność')+labs(x="time")+theme_bw()
ggplot(data = wykres2, aes(x = "time"))  +
geom_line(aes(y = H), colour="blue",size = .5)+
geom_line(aes(y = filtered_H), colour="red",size = .5)+
ggtitle('log-zmienność')+labs(x="time")+theme_bw()
ggplot(data = wykres2, aes(x = time))  +
geom_line(aes(y = H), colour="blue",size = .5)+
geom_line(aes(y = filtered_H), colour="red",size = .5)+
ggtitle('log-zmienność')+labs(x="time")+theme_bw()
g1<-ggplot(data = wykres2, aes(x = 1:n, y = y))  +
geom_line(color = "royalblue", size = .5)+ggtitle('zwroty')+labs(x="time")+theme_bw()
g2<-ggplot(data = wykres2, aes(x = time))  +
geom_line(aes(y = H), colour="blue",size = .5)+
geom_line(aes(y = filtered_H), colour="red",size = .5)+
ggtitle('log-zmienność')+labs(x="time")+theme_bw()
g3<-ggplot(data = wykres2, aes(x = 1:n, y = exp(H/2)) )  +
geom_line(color = "royalblue", size = .5)+ggtitle('zmienność')+labs(x="time")+theme_bw()
g4<-ggplot(data = wykres2, aes(x = 1:n, y = eff.sample.size))  +
geom_line(color = "royalblue", size = .5)+ggtitle('eff.sample.size')+labs(x="time")+theme_bw()
g5<-ggplot(data = wykres2, aes(x = 1:n, y = cond.loglik))  +
geom_line(color = "royalblue", size = .5)+ggtitle('cond.loglik')+labs(x="time")+theme_bw()
grid.arrange(g1, g4,g2,g5,g3, nrow=3,ncol=2)
?geom_line
ggplot(data = wykres2, aes(x = 1:n, y = eff.sample.size))  +
geom_line(color = "royalblue", size = .5,show.legend=TRUE)+ggtitle('eff.sample.size')+labs(x="time")+theme_bw()
ggplot(data = wykres2, aes(x = 1:n, y = eff.sample.size))  +
geom_line(color = "royalblue", size = .5)+ggtitle('eff.sample.size')+labs(x="time")+theme_bw()
g1<-ggplot(data = wykres2, aes(x = 1:n, y = y))  +
geom_line(color = "royalblue", size = .5)+ggtitle('zwroty')+labs(x="time")+theme_bw()
g2<-ggplot(data = wykres2, aes(x = time))  +
geom_line(aes(y = H), colour="blue",size = .5)+
geom_line(aes(y = filtered_H), colour="red",size = .5,linetype = "dotted")+
ggtitle('log-zmienność')+labs(x="time")+theme_bw()
g3<-ggplot(data = wykres2, aes(x = 1:n, y = exp(H/2)) )  +
geom_line(color = "royalblue", size = .5)+ggtitle('zmienność')+labs(x="time")+theme_bw()
g4<-ggplot(data = wykres2, aes(x = 1:n, y = eff.sample.size))  +
geom_line(color = "royalblue", size = .5)+ggtitle('eff.sample.size')+labs(x="time")+theme_bw()
g5<-ggplot(data = wykres2, aes(x = 1:n, y = cond.loglik))  +
geom_line(color = "royalblue", size = .5)+ggtitle('cond.loglik')+labs(x="time")+theme_bw()
grid.arrange(g1, g4,g2,g5,g3, nrow=3,ncol=2)
g1<-ggplot(data = wykres2, aes(x = 1:n, y = y))  +
geom_line(color = "royalblue", size = .5)+ggtitle('zwroty')+labs(x="time")+theme_bw()
g2<-ggplot(data = wykres2, aes(x = time))  +
geom_line(aes(y = H), colour="blue",size = .5)+
geom_line(aes(y = filtered_H), colour="red",size = .5,linetype = "dashed")+
ggtitle('log-zmienność')+labs(x="time")+theme_bw()
g3<-ggplot(data = wykres2, aes(x = 1:n, y = exp(H/2)) )  +
geom_line(color = "royalblue", size = .5)+ggtitle('zmienność')+labs(x="time")+theme_bw()
g4<-ggplot(data = wykres2, aes(x = 1:n, y = eff.sample.size))  +
geom_line(color = "royalblue", size = .5)+ggtitle('eff.sample.size')+labs(x="time")+theme_bw()
g5<-ggplot(data = wykres2, aes(x = 1:n, y = cond.loglik))  +
geom_line(color = "royalblue", size = .5)+ggtitle('cond.loglik')+labs(x="time")+theme_bw()
grid.arrange(g1, g4,g2,g5,g3, nrow=3,ncol=2)
grid.arrange(g1, g4,g2,g5,g3, nrow=3,ncol=2)
g1<-ggplot(data = wykres2, aes(x = 1:n, y = y))  +
geom_line(color = "royalblue", size = .5)+ggtitle('zwroty')+labs(x="time")+theme_bw()
g2<-ggplot(data = wykres2, aes(x = time))  +
geom_line(aes(y = H), colour="royalblue",size = .5)+
geom_line(aes(y = filtered_H), colour="red",size = .5,linetype = "dashed")+
ggtitle('log-zmienność')+labs(x="time")+theme_bw()
g3<-ggplot(data = wykres2, aes(x = 1:n, y = exp(H/2)) )  +
geom_line(aes(y = exp(H/2)), colour="royalblue",size = .5)+
geom_line(aes(y = filtered_exp(H/2)), colour="red",size = .5,linetype = "dashed")+
ggtitle('zmienność')+labs(x="time")+theme_bw()
g4<-ggplot(data = wykres2, aes(x = 1:n, y = eff.sample.size))  +
geom_line(color = "royalblue", size = .5)+ggtitle('eff.sample.size')+labs(x="time")+theme_bw()
g5<-ggplot(data = wykres2, aes(x = 1:n, y = cond.loglik))  +
geom_line(color = "royalblue", size = .5)+ggtitle('cond.loglik')+labs(x="time")+theme_bw()
grid.arrange(g1, g4,g2,g5,g3, nrow=3,ncol=2)
wykres2.matrix<-rbind(pf1@data,
pf1@eff.sample.size,
pf1@cond.loglik,
pf1@filter.traj[1, 1,2:1001],
exp(pf1@filter.traj[1, 1,2:1001]/2),
log.volatility.list$states[1,1,],
exp(log.volatility.list$states[1,1,]/2),
1:n)
row.names(wykres2.matrix)<-c("y","eff.sample.size","cond.loglik",
"filtered_H", "filtered_exp(H/2)","H","exp(H/2)","time")
wykres2<-as.data.frame(t(wykres2.matrix))
wykres2a<-as.data.frame(t(wykres2.matrix[c(4,6,8),]))
wykres2a.long<-gather(data=wykres2a,key,value,"H","filtered_H")
g1<-ggplot(data = wykres2, aes(x = 1:n, y = y))  +
geom_line(color = "royalblue", size = .5)+ggtitle('zwroty')+labs(x="time")+theme_bw()
g2<-ggplot(data = wykres2, aes(x = time))  +
geom_line(aes(y = H), colour="royalblue",size = .5)+
geom_line(aes(y = filtered_H), colour="red",size = .5,linetype = "dashed")+
ggtitle('log-zmienność')+labs(x="time")+theme_bw()
g3<-ggplot(data = wykres2, aes(x = 1:n, y = exp(H/2)) )  +
geom_line(aes(y = exp(H/2)), colour="royalblue",size = .5)+
geom_line(aes(y = filtered_exp(H/2)), colour="red",size = .5,linetype = "dashed")+
ggtitle('zmienność')+labs(x="time")+theme_bw()
g4<-ggplot(data = wykres2, aes(x = 1:n, y = eff.sample.size))  +
geom_line(color = "royalblue", size = .5)+ggtitle('eff.sample.size')+labs(x="time")+theme_bw()
g5<-ggplot(data = wykres2, aes(x = 1:n, y = cond.loglik))  +
geom_line(color = "royalblue", size = .5)+ggtitle('cond.loglik')+labs(x="time")+theme_bw()
grid.arrange(g1, g4,g2,g5,g3, nrow=3,ncol=2)
filtered_exp(H/2)
g1<-ggplot(data = wykres2, aes(x = 1:n, y = y))  +
geom_line(color = "royalblue", size = .5)+ggtitle('zwroty')+labs(x="time")+theme_bw()
g2<-ggplot(data = wykres2, aes(x = time))  +
geom_line(aes(y = H), colour="royalblue",size = .5)+
geom_line(aes(y = filtered_H), colour="red",size = .5,linetype = "dashed")+
ggtitle('log-zmienność')+labs(x="time")+theme_bw()
g3<-ggplot(data = wykres2, aes(x = 1:n, y = exp(H/2)) )  +
geom_line(aes(y = "exp(H/2)"), colour="royalblue",size = .5)+
geom_line(aes(y = "filtered_exp(H/2)"), colour="red",size = .5,linetype = "dashed")+
ggtitle('zmienność')+labs(x="time")+theme_bw()
g4<-ggplot(data = wykres2, aes(x = 1:n, y = eff.sample.size))  +
geom_line(color = "royalblue", size = .5)+ggtitle('eff.sample.size')+labs(x="time")+theme_bw()
g5<-ggplot(data = wykres2, aes(x = 1:n, y = cond.loglik))  +
geom_line(color = "royalblue", size = .5)+ggtitle('cond.loglik')+labs(x="time")+theme_bw()
grid.arrange(g1, g4,g2,g5,g3, nrow=3,ncol=2)
grid.arrange(g1, g4,g2,g5,g3, nrow=3,ncol=2)
ggplot(data = wykres2, aes(x = 1:n, y = exp(H/2)) )  +
geom_line(aes(y = "exp(H/2)"), colour="royalblue",size = .5)+
geom_line(aes(y = "filtered_exp(H/2)"), colour="red",size = .5,linetype = "dashed")+
ggtitle('zmienność')+labs(x="time")+theme_bw()
"exp(H/2)"
wykres2.matrix<-rbind(pf1@data,
pf1@eff.sample.size,
pf1@cond.loglik,
pf1@filter.traj[1, 1,2:1001],
exp(pf1@filter.traj[1, 1,2:1001]/2),
log.volatility.list$states[1,1,],
exp(log.volatility.list$states[1,1,]/2),
1:n)
row.names(wykres2.matrix)<-c("y","eff.sample.size","cond.loglik",
"filtered_H", "filtered_exp(H/2)","H","exp(H/2)","time")
wykres2<-as.data.frame(t(wykres2.matrix))
wykres2a<-as.data.frame(t(wykres2.matrix[c(4,6,8),]))
wykres2a.long<-gather(data=wykres2a,key,value,"H","filtered_H")
str(wykres2)
wykres2
ggplot(data = wykres2, aes(x = time))  +
geom_line(aes(y = "H"), colour="royalblue",size = .5)+
geom_line(aes(y = "filtered_H"), colour="red",size = .5,linetype = "dashed")+
ggtitle('log-zmienność')+labs(x="time")+theme_bw()
ggplot(data = wykres2, aes(x = 1:n, y = exp(H/2)) )  +
geom_line(aes(y = exp(H/2)), colour="royalblue",size = .5)+
geom_line(aes(y = filtered_exp(H/2)), colour="red",size = .5,linetype = "dashed")+
ggtitle('zmienność')+labs(x="time")+theme_bw()
wykres2.matrix<-rbind(pf1@data,
pf1@eff.sample.size,
pf1@cond.loglik,
pf1@filter.traj[1, 1,2:1001],
exp(pf1@filter.traj[1, 1,2:1001]/2),
log.volatility.list$states[1,1,],
exp(log.volatility.list$states[1,1,]/2),
1:n)
row.names(wykres2.matrix)<-c("y","eff.sample.size","cond.loglik",
"filtered_H", "filtered_exp","H","exp","time")
wykres2<-as.data.frame(t(wykres2.matrix))
ggplot(data = wykres2, aes(x = 1:n ))  +
geom_line( aes(y = exp), colour="royalblue",size = .5)+
geom_line( aes(y = filtered_exp), colour="red",size = .5,linetype = "dashed")+
ggtitle( 'zmienność')+labs(x="time",y="exp(H/2)")+theme_bw()
g1<-ggplot(data = wykres2, aes(x = 1:n, y = y))  +
geom_line(color = "royalblue", size = .5)+ggtitle('zwroty')+labs(x="time")+theme_bw()
g2<-ggplot(data = wykres2, aes(x = time))  +
geom_line(aes(y = H), colour="royalblue",size = .5)+
geom_line(aes(y = filtered_H), colour="red",size = .5,linetype = "dashed")+
ggtitle('log-zmienność')+labs(x="time")+theme_bw()
g3<-ggplot(data = wykres2, aes(x = 1:n ))  +
geom_line( aes(y = exp), colour="royalblue",size = .5)+
geom_line( aes(y = filtered_exp), colour="red",size = .5,linetype = "dashed")+
ggtitle( 'zmienność')+labs(x="time",y="exp(H/2)")+theme_bw()
g4<-ggplot(data = wykres2, aes(x = 1:n, y = eff.sample.size))  +
geom_line(color = "royalblue", size = .5)+ggtitle('eff.sample.size')+labs(x="time")+theme_bw()
g5<-ggplot(data = wykres2, aes(x = 1:n, y = cond.loglik))  +
geom_line(color = "royalblue", size = .5)+ggtitle('cond.loglik')+labs(x="time")+theme_bw()
grid.arrange(g1, g4,g2,g5,g3, nrow=3,ncol=2)
library(reshape2)
wykres2a.long<-melt(wykres2a,id="time")
?melt
wykres2a.long<-melt(wykres2a,id="time",value.name="H")
#druga wersja
g2a<-ggplot(data = wykres2, aes(x = time,y=H),colour=variable)
ggplot(data = wykres2, aes(x = time,y=H),colour=variable)
ggplot(data = wykres2, aes(x = time,y=H),colour=variable) +
geom_line(size = .5)
ggplot(data = wykres2a.long, aes(x = time,y=H),colour=variable) +
geom_line(size = .5)
wykres2a.long
str(wykres2a.long)
wykres2a.long<-melt(wykres2a,id="time")
str(wykres2a.long)
g2a<-ggplot(data = wykres2a.long, aes(x = time,y=value,colour=variable) ) +
geom_line(size = .5)
ggplot(data = wykres2a.long, aes(x = time,y=value,colour=variable) ) +
geom_line(size = .5)
ggplot(data = wykres2a.long, aes(x = time,y=value,colour=variable) ) +
geom_line(size = .5)+labs(y="H")+theme_bw()+scale_colour_manual(values=c("red", "royalblue"))
ggplot(data = wykres2a.long, aes(x = time,y=value,colour=variable) ) +
geom_line(size = .5)+labs(y="H")+theme_bw()+scale_colour_manual(values=c("tomato", "royalblue"))
wykres2a.long
str(wykres2a.long)
names(wykres2a.long)
?names
names(wykres2a.long)<-c("time","Typ","value")
names(wykres2a.long)<-c("time","Rodzaj","value")
ggplot(data = wykres2a.long, aes(x = time,y=value,colour=Rodzaj) ) +
geom_line(size = .5)+labs(y="H")+theme_bw()+scale_colour_manual(values=c("tomato", "royalblue"))
names(wykres2a)
names(wykres2a)<-c("filtered_H", "H","time")
ggplot(data = wykres2a.long, aes(x = time,y=value,colour=Rodzaj) ) +
geom_line(size = .5)+labs(y="H")+theme_bw()+scale_colour_manual(values=c("tomato", "royalblue"))
names(wykres2a)<-c("Filtracja", "Symulacja","time")
wykres2a.long<-melt(wykres2a,id="time")
names(wykres2a.long)<-c("time","Rodzaj","value")
ggplot(data = wykres2a.long, aes(x = time,y=value,colour=Rodzaj) ) +
geom_line(size = .5)+labs(y="H")+theme_bw()+scale_colour_manual(values=c("tomato", "royalblue"))
grid.arrange(g1, g4,g2a,g5,g3, nrow=3,ncol=2)
g2a<-ggplot(data = wykres2a.long, aes(x = time,y=value,colour=Rodzaj) ) +
geom_line(size = .5)+labs(y="H")+theme_bw()+scale_colour_manual(values=c("tomato", "royalblue"))
grid.arrange(g1, g4,g2a,g5,g3, nrow=3,ncol=2)
grid.arrange(g1, g4,g2,g5,g3, nrow=3,ncol=2)
wykres2b<-as.data.frame(t(wykres2.matrix[c(5,7,8),]))
names(wykres2b)<-c("Filtracja", "Symulacja","time")
wykres2b.long<-melt(wykres2a,id="time")
names(wykres2b.long)<-c("time","Rodzaj","value")
ggplot(data = wykres2b.long, aes(x = time,y=value,colour=Rodzaj) ) +
geom_line(size = .5)+labs(y="H")+theme_bw()+scale_colour_manual(values=c("tomato", "royalblue"))
wykres2b<-as.data.frame(t(wykres2.matrix[c(5,7,8),]))
names(wykres2b)<-c("Filtracja", "Symulacja","time")
wykres2b.long<-melt(wykres2a,id="time")
names(wykres2b.long)<-c("time","Rodzaj","value")
ggplot(data = wykres2b.long, aes(x = time,y=value,colour=Rodzaj) ) +
geom_line(size = .5)+labs(y="exp(H/2)")+theme_bw()+scale_colour_manual(values=c("tomato", "royalblue"))
wykres2b.long
wykres2.matrix[c(5,7,8),]
wykres2b<-as.data.frame(t(wykres2.matrix[c(5,7,8),]))
names(wykres2b)<-c("Filtracja", "Symulacja","time")
wykres2b.long<-melt(wykres2b,id="time")
names(wykres2b.long)<-c("time","Rodzaj","value")
ggplot(data = wykres2b.long, aes(x = time,y=value,colour=Rodzaj) ) +
geom_line(size = .5)+labs(y="exp(H/2)")+theme_bw()+scale_colour_manual(values=c("tomato", "royalblue"))
grid.arrange(g1, g2a,g3, g4a,g5, nrow=3,ncol=2)
grid.arrange(g1, g2a,g3, g4,g5, nrow=3,ncol=2)
grid.arrange(g1, g2a,g4, g3a,g5, nrow=3,ncol=2)
g3a<-ggplot(data = wykres2b.long, aes(x = time,y=value,colour=Rodzaj) ) +
geom_line(size = .5)+labs(y="exp(H/2)")+theme_bw()+scale_colour_manual(values=c("tomato", "royalblue"))
grid.arrange(g1, g2a,g4, g3a,g5, nrow=3,ncol=2)
#druga wersja
g2a<-ggplot(data = wykres2a.long, aes(x = time,y=value,colour=Rodzaj) ) +ggtitle('log-zmienność')+
geom_line(size = .5)+labs(y="H")+theme_bw()+scale_colour_manual(values=c("tomato", "royalblue"))
g3<-ggplot(data = wykres2, aes(x = 1:n ))  +
geom_line( aes(y = exp), colour="royalblue",size = .5)+
geom_line( aes(y = filtered_exp), colour="red",size = .5,linetype = "dashed")+
ggtitle( 'zmienność')+labs(x="time",y="exp(H/2)")+theme_bw()
#druga wersja
g3a<-ggplot(data = wykres2b.long, aes(x = time,y=value,colour=Rodzaj) ) +ggtitle('zmienność')+
geom_line(size = .5)+labs(y="exp(H/2)")+theme_bw()+scale_colour_manual(values=c("tomato", "royalblue"))
grid.arrange(g1, g2a,g4, g3a,g5, nrow=3,ncol=2)
"filtered_H", "filtered_exp","H","exp","time")
wykres2<-as.data.frame(t(wykres2.matrix))
wykres2a<-as.data.frame(t(wykres2.matrix[c(6,4,8),]))
names(wykres2a)<-c("Symulacja","Filtracja", "time")
wykres2a.long<-melt(wykres2a,id="time")
names(wykres2a.long)<-c("time","Rodzaj","value")
wykres2b<-as.data.frame(t(wykres2.matrix[c(7,5,8),]))
names(wykres2b)<-c("Symulacja","Filtracja", "time")
wykres2b.long<-melt(wykres2b,id="time")
names(wykres2b.long)<-c("time","Rodzaj","value")
wykres2<-as.data.frame(t(wykres2.matrix))
wykres2a<-as.data.frame(t(wykres2.matrix[c(6,4,8),]))
names(wykres2a)<-c("Symulacja","Filtracja", "time")
wykres2a.long<-melt(wykres2a,id="time")
names(wykres2a.long)<-c("time","Rodzaj","value")
wykres2b<-as.data.frame(t(wykres2.matrix[c(7,5,8),]))
names(wykres2b)<-c("Symulacja","Filtracja", "time")
wykres2b.long<-melt(wykres2b,id="time")
names(wykres2b.long)<-c("time","Rodzaj","value")
ggplot(data = wykres2b.long, aes(x = time,y=value,colour=Rodzaj) ) +ggtitle('zmienność')+
geom_line(size = .5)+labs(y="exp(H/2)")+theme_bw()+scale_colour_manual(values=c("tomato", "royalblue"))
ggplot(data = wykres2a.long, aes(x = time,y=value,colour=Rodzaj) ) +ggtitle('log-zmienność')+
geom_line(size = .5)+labs(y="H")+theme_bw()+scale_colour_manual(values=c("royalblue","tomato"))
ggplot(data = wykres2a.long, aes(x = time,y=value,colour=Rodzaj) ) +ggtitle('log-zmienność')+
geom_line(size = .5)+labs(y="H")+theme_bw()+scale_colour_manual(values=c("royalblue","tomato"))+
scale_linetype_manual(values=c("solid", "dashed"))
ggplot(data = wykres2a.long, aes(x = time,y=value,colour=Rodzaj,linetype=Rodzaj) ) +ggtitle('log-zmienność')+
geom_line(size = .5)+labs(y="H")+theme_bw()+scale_colour_manual(values=c("royalblue","tomato"))+
scale_linetype_manual(values=c("solid", "dashed"))
g1<-ggplot(data = wykres2, aes(x = 1:n, y = y))  +
geom_line(color = "royalblue", size = .5)+ggtitle('zwroty')+labs(x="time")+theme_bw()
g2<-ggplot(data = wykres2, aes(x = time))  +
geom_line(aes(y = H), colour="royalblue",size = .5)+
geom_line(aes(y = filtered_H), colour="red",size = .5,linetype = "dashed")+
ggtitle('log-zmienność')+labs(x="time")+theme_bw()
#druga wersja
g2a<-ggplot(data = wykres2a.long, aes(x = time,y=value,colour=Rodzaj,linetype=Rodzaj) ) +ggtitle('log-zmienność')+
geom_line(size = .5)+labs(y="H")+theme_bw()+scale_colour_manual(values=c("royalblue","tomato"))+
scale_linetype_manual(values=c("solid", "dashed"))
g3<-ggplot(data = wykres2, aes(x = 1:n ))  +
geom_line( aes(y = exp), colour="royalblue",size = .5)+
geom_line( aes(y = filtered_exp), colour="red",size = .5,linetype = "dashed")+
ggtitle( 'zmienność')+labs(x="time",y="exp(H/2)")+theme_bw()
#druga wersja
g3a<-ggplot(data = wykres2b.long, aes(x = time,y=value,colour=Rodzaj,linetype=Rodzaj) ) +ggtitle('zmienność')+
geom_line(size = .5)+labs(y="exp(H/2)")+theme_bw()+scale_colour_manual(values=c("royalblue","tomato"))+
scale_linetype_manual(values=c("solid", "dashed"))
g4<-ggplot(data = wykres2, aes(x = 1:n, y = eff.sample.size))  +
geom_line(color = "royalblue", size = .5)+ggtitle('eff.sample.size')+labs(x="time")+theme_bw()
g5<-ggplot(data = wykres2, aes(x = 1:n, y = cond.loglik))  +
geom_line(color = "royalblue", size = .5)+ggtitle('cond.loglik')+labs(x="time")+theme_bw()
grid.arrange(g1, g2a,g4, g3a,g5, nrow=3,ncol=2)
detectCores()
cl <- makeCluster(3, type = "SOCK")
registerDoSNOW(cl)
start_time <- Sys.time()
t.if.bsv <- system.time({
if.bsv <- foreach(i=1:bsvlist[[5]][run_level] ,
.packages='pomp', .combine=c,.export = "bsvlist",
.options.multicore=list(set.seed=TRUE)) %dopar% try(
pomp::mif2(bsv.filt,start=params_test,Np=bsvlist[[1]][run_level] , Nmif=bsvlist[[2]][run_level] ,cooling.type="geometric",
cooling.fraction.50=bsv_cooling.fraction.50,
transform=TRUE,
rw.sd = rw.sd(
mu      = bsv_rw.sd_rp,
phi       = bsv_rw.sd_rp,
sigma_eta = bsv_rw.sd_rp
)
)
)
L.if.bsv <- foreach(i=1:bsvlist[[5]][run_level] ,.packages='pomp', .export = "bsvlist",
.combine=rbind,.options.multicore=list(set.seed=TRUE)) %dopar% try(
logmeanexp(
replicate(bsvlist[[3]][run_level] ,
logLik(pfilter(bsv.filt,params=coef(if.bsv[[i]]),Np=bsvlist[[1]][run_level]  ))
),
se=TRUE)
)
H.if.bsv<- foreach(i=1:bsvlist[[5]][run_level] ,.packages='pomp', .export = "bsvlist",
.combine=cbind,.options.multicore=list(set.seed=TRUE)) %dopar% try(
exp(pfilter(bsv.filt,params=coef(if.bsv[[i]]),Np=bsvlist[[1]][run_level],pred.mean=TRUE)@pred.mean[1,])
)
})
stopCluster(cl)
end_time <- Sys.time()
difftime(end_time,start_time, units = "mins")
plot(if.bsv)
summary(r.if.bsv$logLik,digits=5)
r.if.bsv[which.max(r.if.bsv$logLik),]
pairs(~logLik+mu_h+phi+sigma_eta,data=r.if.bsv)
pairs(~logLik+mu+phi+sigma_eta,data=r.if.bsv)
